var I=(e,t,i)=>new Promise((r,a)=>{var d=s=>{try{n(i.next(s))}catch(m){a(m)}},o=s=>{try{n(i.throw(s))}catch(m){a(m)}},n=s=>s.done?r(s.value):Promise.resolve(s.value).then(d,o);n((i=i.apply(e,t)).next())});import{d as W,a as X,T as E}from"./index.91fe59c6.js";import{b as P,a9 as _,M as j,ag as z,G as x,aO as w,k as c,aL as Y,ci as h,ei as u,ej as p,a_ as L,c as q,a$ as S,o as H,b0 as U,l as f,b3 as J,cl as A,j as B,r as Z,b8 as D,s as N,m as R,p as ee,ek as te,el as oe}from"./index.23965316.js";import{C as T,S as O}from"./index.b43c7946.js";import"./index.b163296c.js";import"./index.c8ee7c1a.js";import{B as ne,l as ae}from"./useForm.37d1448d.js";import{D as V}from"./index.e35512a5.js";import{B as re,a as se,b as ie}from"./index.48aaa24a.js";import"./index.a8ee9265.js";import"./_baseIteratee.b86b01a2.js";import"./isEqual.d65954b3.js";import"./scrollTo.683c5f3d.js";import"./index.83f13437.js";import"./index.b5cd44d2.js";import"./useContentViewHeight.553e56bf.js";import"./ArrowLeftOutlined.686d2e0c.js";import"./index.08362023.js";import"./index.9863576d.js";import"./index.72f58c9d.js";import"./RedoOutlined.1e197eb0.js";var M=P({name:"ACardMeta",props:{prefixCls:_.string,title:_.VNodeChild,description:_.VNodeChild,avatar:_.VNodeChild},setup:function(){return{configProvider:j("configProvider",z)}},render:function(){var t=this.$props.prefixCls,i=this.configProvider.getPrefixCls,r=i("card",t),a=x({},"".concat(r,"-meta"),!0),d=w(this,"avatar"),o=w(this,"title"),n=w(this,"description"),s=d?c("div",{class:"".concat(r,"-meta-avatar")},[d]):null,m=o?c("div",{class:"".concat(r,"-meta-title")},[o]):null,g=n?c("div",{class:"".concat(r,"-meta-description")},[n]):null,F=m||g?c("div",{class:"".concat(r,"-meta-detail")},[m,g]):null;return c("div",{class:a},[s,F])}}),$=P({name:"ACardGrid",__ANT_CARD_GRID:!0,props:{prefixCls:_.string,hoverable:_.looseBool},setup:function(){return{configProvider:j("configProvider",z)}},render:function(){var t,i=this.$props,r=i.prefixCls,a=i.hoverable,d=a===void 0?!0:a,o=this.configProvider.getPrefixCls,n=o("card",r),s=(t={},x(t,"".concat(n,"-grid"),!0),x(t,"".concat(n,"-grid-hoverable"),d),t);return c("div",{class:s},[Y(this)])}});T.Meta=M;T.Grid=$;T.install=function(e){return e.component(T.name,T),e.component(M.name,M),e.component($.name,$),e};const le=[{label:h.ShaftingSystem.name,value:h.ShaftingSystem.id},{label:h.RudderSystem.name,value:h.RudderSystem.id},{label:h.NonStandardPart.name,value:h.NonStandardPart.id},{label:h.StandardPart.name,value:h.StandardPart.id},{label:h.Other.name,value:h.Other.id}],K=[{label:u.Blanking.name,value:u.Blanking.id},{label:u.RoughTurning.name,value:u.RoughTurning.id},{label:u.FineTurning.name,value:u.FineTurning.id},{label:u.Perforate.name,value:u.Perforate.id},{label:u.FineMilling.name,value:u.FineMilling.id},{label:u.Compounding.name,value:u.Compounding.id}],ce=[{label:p.One.name,value:p.One.id},{label:p.Two.name,value:p.Two.id},{label:p.Three.name,value:p.Three.id},{label:p.Four.name,value:p.Four.id},{label:p.Five.name,value:p.Five.id},{label:p.Six.name,value:p.Six.id}],de=[{align:"center",title:"\u6B65\u9AA4",dataIndex:"stepIndex",key:"stepIndex",customRender:({text:e})=>`\u7B2C ${e} \u6B65`},{align:"center",title:"\u6280\u672F\u7C7B\u578B",key:"technologyTypeId",dataIndex:"technologyTypeId",customRender:({text:e})=>{var t;return`${(t=u.from(e))==null?void 0:t.name}`}},{align:"center",title:"\u5DE5\u4F5C\u533A",key:"workStationNo",dataIndex:"workStationNo",customRender:({text:e})=>{var t;return`${(t=p.from(e))==null?void 0:t.name}`}},{align:"center",title:"\u64CD\u4F5C",key:"action",slots:{customRender:"action"}}],G=[{field:"technologyTypeId",component:"Select",label:"\u6280\u672F\u8981\u6C42",required:!0,componentProps:{options:K}},{field:"workStationNo",component:"Select",label:"\u5DE5\u4F5C\u8F66\u95F4",required:!0,componentProps:{options:ce}}],ue=P({components:{BasicModal:re,BasicForm:ne},props:{isEdit:Boolean,technologyTypeId:Number,workStationNo:String},emits:["ok"],setup(e,{emit:t}){const i=q(()=>e.isEdit?"\u7F16\u8F91":"\u65B0\u589E"),[r,{validate:a,setFieldsValue:d}]=ae({labelWidth:120,schemas:G,showActionButtonGroup:!1,actionColOptions:{span:24}}),[o,{setModalProps:n,closeModal:s}]=se(g=>{g.isEdit&&d({technologyTypeId:g.technologyTypeId,workStationNo:g.workStationNo})});function m(){return I(this,null,function*(){try{const g=yield a();n({confirmLoading:!0}),s(),t("ok",{technologyTypeId:g.technologyTypeId,workStationNo:g.workStationNo})}finally{n({confirmLoading:!1})}})}return{register:o,productTechnologyFormSchemas:G,registerForm:r,getTitle:i,handleSubmit:m}}});function pe(e,t,i,r,a,d){const o=S("BasicForm"),n=S("BasicModal");return H(),U(n,J(e.$attrs,{onRegister:e.register,title:e.getTitle,onOk:e.handleSubmit}),{default:f(()=>[c(o,{onRegister:e.registerForm},null,8,["onRegister"])]),_:1},16,["onRegister","title","onOk"])}var me=L(ue,[["render",pe]]);function ge(e,t="message"){return I(this,null,function*(){return yield W.get({url:`/ProductTechnology/${e}`},{errorMessageMode:t})})}function he(e,t="message"){return I(this,null,function*(){return yield W.post({url:"/ProductTechnology",params:e},{errorMessageMode:t})})}const ve=P({name:"CreateProductTechnologyPage",components:{PageWrapper:X,[T.name]:T,[O.name]:O,[A.name]:A,[E.name]:E,[V.name]:V,CreateProductTechnologyModal:me},setup(){const{createMessage:e}=ee(),[t,{openModal:i}]=ie(),r=B({title:"\u7F16\u8F91"}),a=B({technologyTypeId:1,workStationNo:"01",stepIndex:0}),d=Z(0),o=B([]),n=q(()=>o.length==0?0:o.sort(l=>l.stepIndex)[o.length-1].stepIndex);return{productTypeOptions:le,selectedProductType:d,technologyTypeOptions:K,productTechnologySteps:o,productTechnologyStepSchemas:de,showEditModel:r,modalData:a,registerModal:t,saveStep:l=>{l.stepIndex==0||!l.stepIndex?o.push({stepIndex:n.value+1,technologyTypeId:l.technologyTypeId,workStationNo:l.workStationNo,key:`${n.value+1}`}):o.forEach(v=>{v.stepIndex==l.stepIndex&&(v.technologyTypeId=l.technologyTypeId,v.workStationNo=l.workStationNo)})},handleChange:l=>I(this,null,function*(){var y,C;const v=yield ge(l);o.length=0,(C=(y=v.data)==null?void 0:y.productTechnologyItemDtos)==null||C.forEach(k=>o.push({key:k.stepIndex+k.workStationNo,stepIndex:k.stepIndex,workStationNo:k.workStationNo,technologyTypeId:k.technologyTypeId}))}),addStep:()=>{i(!0,{}),a.stepIndex=0,a.technologyTypeId=1,a.workStationNo="01"},saveProductTech:()=>I(this,null,function*(){yield he({productTypeId:d.value,productTechnologyItemDtos:o}),e.success("\u4FDD\u5B58\u6210\u529F")}),deleteStep:l=>{const{stepIndex:v}=D(l);o.splice(o.findIndex(y=>y.stepIndex==v),1),o.forEach((y,C)=>{y.stepIndex=C+1})},editStep:l=>{r.title="\u7F16\u8F91";const{stepIndex:v,technologyTypeId:y,workStationNo:C}=D(l);a.stepIndex=v,a.technologyTypeId=y,a.workStationNo=C}}}}),ye=e=>(te("data-v-32653518"),e=e(),oe(),e),fe=ye(()=>N("h2",null,"\u4EA7\u54C1\u7C7B\u578B\uFF1A",-1)),Se=["onClick"];function Te(e,t,i,r,a,d){const o=S("a-select"),n=S("a-card"),s=S("a-table"),m=S("a-button"),g=S("CreateProductTechnologyModal"),F=S("PageWrapper");return H(),U(F,{class:"high-form",title:"\u4EA7\u54C1\u521B\u5EFA",content:"\u8BF7\u8F93\u5165\u4EA7\u54C1\u4FE1\u606F\u540E\u6DFB\u52A0\u4EA7\u54C1\u9879"},{default:f(()=>[c(n,{title:"\u6A21\u677F\u521B\u5EFA",bordered:!1},{default:f(()=>[fe,c(o,{ref:"productTypeOptionsRef",placeholder:"\u8BF7\u9009\u62E9",value:e.selectedProductType,"onUpdate:value":t[0]||(t[0]=b=>e.selectedProductType=b),style:{width:"30%"},options:e.productTypeOptions,onChange:e.handleChange},null,8,["value","options","onChange"])]),_:1}),c(n,{title:"\u6A21\u677F\u6B65\u9AA4",bordered:!1,class:"!mt-5"},{default:f(()=>[c(s,{size:"small",columns:e.productTechnologyStepSchemas,pagination:!1,"data-source":e.productTechnologySteps},{action:f(({record:b})=>[N("span",null,[N("a",{onClick:Q=>e.deleteStep(b)},"\u5220\u9664",8,Se)])]),_:1},8,["columns","data-source"]),c(m,{block:"",class:"mt-5",onClick:e.addStep},{default:f(()=>[R(" \u65B0\u589E ")]),_:1},8,["onClick"])]),_:1}),c(n,{bordered:!1,align:"center",class:"!mt-5"},{default:f(()=>[c(m,{type:"primary",onClick:e.saveProductTech,class:"!ml-5"},{default:f(()=>[R("\u4FDD\u5B58")]),_:1},8,["onClick"])]),_:1}),c(g,J(e.$attrs,{onRegister:e.registerModal,onOk:e.saveStep}),null,16,["onRegister","onOk"])]),_:1})}var je=L(ve,[["render",Te],["__scopeId","data-v-32653518"]]);export{je as default};
