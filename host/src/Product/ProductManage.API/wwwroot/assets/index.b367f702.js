var D=(e,t,o)=>new Promise((i,m)=>{var p=n=>{try{r(o.next(n))}catch(s){m(s)}},u=n=>{try{r(o.throw(n))}catch(s){m(s)}},r=n=>n.done?i(n.value):Promise.resolve(n.value).then(p,u);r((o=o.apply(e,t)).next())});import{ch as f,ci as k,cj as l,bW as A,b as w,a_ as T,c as v,a$ as h,o as b,e as $,k as F,l as g,b8 as W,i as I,p as x,aE as M,j as y,b5 as N,F as L,aG as O,b0 as U}from"./index.23965316.js";import{T as S}from"./index.08362023.js";import{g as j,a as z,b as K,u as C}from"./productApi.e312dfc9.js";import{D as V}from"./index.6596aa75.js";import{B as G,u as q}from"./useTable.69b94410.js";import{T as H,R as _,C as P}from"./useForm.37d1448d.js";import"./index.c8ee7c1a.js";import"./index.91fe59c6.js";import"./index.a8ee9265.js";import"./_baseIteratee.b86b01a2.js";import"./isEqual.d65954b3.js";import"./scrollTo.683c5f3d.js";import"./index.83f13437.js";import"./index.b5cd44d2.js";import"./useContentViewHeight.553e56bf.js";import"./ArrowLeftOutlined.686d2e0c.js";import"./index.9863576d.js";import"./index.72f58c9d.js";import"./index.48aaa24a.js";import"./index.e35512a5.js";import"./useSortable.edefc71c.js";import"./RedoOutlined.1e197eb0.js";import"./index.ea762078.js";const E=[{title:"\u4EA7\u54C1\u7C7B\u578B",dataIndex:"productTypeId",width:50,customRender:({text:e})=>{const t=k.fromName(e);return t==null?void 0:t.name}},{title:"\u540D\u79F0",dataIndex:"productItemName",width:50},{title:"\u6280\u672F\u8981\u6C42",dataIndex:"technicalRequirements",width:120},{title:"\u6750\u6599",dataIndex:"material",width:50},{title:"\u957F\u5EA6",dataIndex:"length",width:50},{title:"\u56FE\u53F7",dataIndex:"figureNo",width:50},{title:"\u603B\u8BA1",dataIndex:"amount",width:50},{title:"\u72B6\u6001",dataIndex:"productStatusId",width:50,customRender:({text:e})=>{var o;const t=l.from(e);return console.log(t),A(S,{color:(o=t==null?void 0:t.color)!=null?o:"black"},()=>t==null?void 0:t.name)}}],J=[{field:"description",label:"\u63CF\u8FF0",contentMinWidth:20},{field:"createTime",label:"\u521B\u5EFA\u65F6\u95F4",contentMinWidth:100},{field:"completionRate",label:"\u5B8C\u6210\u7387",contentMinWidth:100,render:e=>`${e} %`},{field:"productStatusId",contentMinWidth:100,label:"\u4EA7\u54C1\u72B6\u6001",render:e=>{var o;const t=l.from(e);return A(S,{color:(o=t==null?void 0:t.color)!=null?o:"black"},()=>t==null?void 0:t.name)}},{field:"totalManHour",contentMinWidth:100,label:"\u5DE5\u65F6"},{field:"addressDetail",contentMinWidth:100,label:"\u5730\u5740"}],R=e=>D(void 0,null,function*(){return e.roles.map(t=>t.value).includes(f.APPROVER.toString())?yield j():yield z(e.username)}),Q=w({components:{Description:V,BasicTable:G,TableAction:H},emits:["reload"],props:{product:Object,productItems:Array},setup(e,{emit:t}){const o=v(()=>e.product.id),{createMessage:i}=x(),[m]=q({dataSource:e.productItems,columns:E,pagination:!1,canResize:!0,bordered:!0,showIndexColumn:!1,scroll:{y:300},showSummary:!1,actionColumn:{width:150,title:"\u64CD\u4F5C",dataIndex:"action",slots:{customRender:"action"}}}),p=a=>{const c=W(a),d=[];switch(c.productStatusId){case l.ApproveProduct.id:case l.CancelledProduct.id:case l.ScarpProduct.id:break;case l.DoneProduct.id:d.push({label:"\u901A\u8FC7",color:"success",auth:[f.APPROVER],popConfirm:{title:"\u662F\u5426\u901A\u8FC7\uFF1F",confirm:u.bind(null,c)}});break;default:d.push({label:"\u5B8C\u6210",color:"success",auth:[f.WORKER],popConfirm:{title:"\u662F\u5426\u5B8C\u6210\uFF1F",confirm:r.bind(null,c)}}),d.push({label:"\u53D6\u6D88",color:"warning",auth:[f.WORKER],popConfirm:{title:"\u662F\u5426\u53D6\u6D88\uFF1F",confirm:n.bind(null,c)}}),d.push({label:"\u62A5\u5E9F",color:"error",auth:[f.WORKER],popConfirm:{title:"\u662F\u5426\u62A5\u5E9F\uFF1F",confirm:s.bind(null,c)}});break}return d},u=a=>{const{id:c}=a;K(o.value,c).then(()=>{i.success(`\u5BF9 ${a.productItemName} \u64CD\u4F5C\u6210\u529F`),t("reload")})},r=a=>{const c=I(),{id:d}=a;C(c.getUserInfo.userId,d,l.DoneProduct.id).then(()=>{i.success(`\u5BF9 ${a.productItemName} \u64CD\u4F5C\u6210\u529F`),t("reload")})},n=a=>{const c=I(),{id:d}=a;C(c.getUserInfo.userId,d,l.CancelledProduct.id).then(()=>{i.success(`\u5BF9 ${a.productItemName} \u64CD\u4F5C\u6210\u529F`),t("reload")})},s=a=>{const c=I(),{id:d}=a;C(c.getUserInfo.userId,d,l.ScarpProduct.id).then(()=>{i.success(`\u5BF9 ${a.productItemName} \u64CD\u4F5C\u6210\u529F`),t("reload")})};return{registerProductItemTable:m,productItemTableColumns:E,productSchemas:J,getActions:p,productIdCompute:o,productData:e.product}}});function X(e,t,o,i,m,p){const u=h("Description"),r=h("TableAction"),n=h("BasicTable");return b(),$("div",null,[F(u,{size:"small",title:"\u4EA7\u54C1\u4FE1\u606F",bordered:!0,column:3,data:e.productData,schema:e.productSchemas},null,8,["data","schema"]),F(n,{size:"small",onRegister:e.registerProductItemTable},{action:g(({record:s})=>[F(r,{actions:e.getActions(s)},null,8,["actions"])]),_:1},8,["onRegister"])])}var B=T(Q,[["render",X]]);const Y=w({name:"ProductItemListPage",components:{ProductInfoCard:B,[_.name]:_,[P.name]:P},setup(){const e=M(),t=I(),o=y([]);R(t.getUserInfo).then(u=>{o.length=0,u.data.forEach(r=>o.push(r))});function i(u){console.log("\u70B9\u51FB\u4E86\u5220\u9664",u)}function m(u){const{id:r}=u;return e(`${O.PRODUCT_DETAIL}/${r}`),{}}function p(){R(t.getUserInfo).then(u=>{o.length=0,u.data.forEach(r=>o.push(r))})}return{ProductInfoCard:B,productsCompute:o,handleAssignTask:i,handleDetail:m,reload:p}}});function Z(e,t,o,i,m,p){const u=h("ProductInfoCard"),r=h("a-col"),n=h("a-row");return b(!0),$(L,null,N(e.productsCompute,s=>(b(),U(n,{style:{"background-color":"whitesmoke"},key:s.productListDto.id,class:"!mt-5 !mb-5"},{default:g(()=>[F(r,{span:24},{default:g(()=>[F(u,{product:s.productListDto,productItems:s.productItemDetailDtos,onReload:e.reload},null,8,["product","productItems","onReload"])]),_:2},1024)]),_:2},1024))),128)}var Et=T(Y,[["render",Z]]);export{Et as default};
